<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投資理財測驗</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // Firebase 初始化
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "https://pccujrjz-f0c56-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>
</head>
<body>
    <h1>投資理財測驗</h1>
    <div id="question-container"></div>
    <button onclick="submitFeedback()">提交回饋</button>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const level = urlParams.get('level');

        const questions = {
            1: [
                { question: "什麼是股票？", options: ["資產", "負債", "收入"], correct: 0, explanation: "股票是一種資產代表公司所有權。" },
                //... 更多題目
            ],
            2: [
                { question: "複利的主要特點是？", options: ["利息上再利息", "一次性利息", "零利息"], correct: 0, explanation: "複利指利息也會產生利息的方式。" },
                //... 更多題目
            ],
            3: [
                { question: "利率風險的來源是？", options: ["利率變動", "通貨膨脹", "市場風險"], correct: 0, explanation: "利率風險主要來自利率的變動影響。" },
                //... 更多題目
            ]
        };

        let currentQuestion = 0;
        let score = 0;
        let feedback = [];

        function loadQuestion() {
            const questionData = questions[level][currentQuestion];
            if (!questionData) {
                document.getElementById('question-container').innerHTML = `測驗完成！正確率：${Math.round((score / questions[level].length) * 100)}%`;
                return;
            }

            const container = document.getElementById('question-container');
            container.innerHTML = `
                <p>${questionData.question}</p>
                ${questionData.options.map((option, index) => `
                    <button onclick="checkAnswer(${index})">${option}</button>
                `).join('')}
            `;
        }

        function checkAnswer(selected) {
            const questionData = questions[level][currentQuestion];
            if (selected === questionData.correct) {
                score++;
                alert("正確！");
            } else {
                alert(`錯誤！正確答案是：${questionData.options[questionData.correct]}\n解析：${questionData.explanation}`);
            }

            const isHelpful = confirm("此解析對您是否有幫助？（按確定表示有，取消表示無）");
            feedback.push({ question: questionData.question, helpful: isHelpful });

            currentQuestion++;
            loadQuestion();
        }

        function submitFeedback() {
            const statsRef = db.ref('quizStats');
            statsRef.once('value').then((snapshot) => {
                const stats = snapshot.val() || { participants: 0, totalScore: 0, helpfulCount: 0, totalQuestions: 0 };

                stats.participants += 1;
                stats.totalScore += score;
                stats.totalQuestions += questions[level].length;
                stats.helpfulCount += feedback.filter(f => f.helpful).length;

                statsRef.set(stats);
                alert("感謝您的參與！測驗結果已提交。");
                window.location.href = "index.html";
            });
        }

        loadQuestion();
    </script>
</body>
</html>
