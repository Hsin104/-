<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投資理財測驗 - 進階級 (Level 2)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // Firebase 初始化
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "https://pccujrjz-f0c56-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>
</head>
<body>
    <h1>投資理財測驗 - 進階級 (Level 2)</h1>
    <div id="question-container"></div>

    <script>
        const questions = [
            {
                "question": "1. 以下哪種情況最能減少投資風險？",
                "options": ["A. 投資於單一股票", "B. 全部資金投入房地產", "C. 分散投資於多種資產", "D. 大量購買黃金"],
                "correct": 2,
                "explanation": "分散投資有助於降低風險，因為資產的價格波動通常不一致。"
            },
            {
                "question": "2. 如果市場波動較大，哪種策略較為合適？",
                "options": ["A. 順勢追高", "B. 快速賣出持有資產", "C. 保持耐心和長期投資策略", "D. 不斷更換投資標的"],
                "correct": 2,
                "explanation": "在波動性高的市場中，保持長期投資心態能降低因短期市場波動而導致的損失。"
            },
            {
                "question": "3. 下列哪種資產適合抵禦長期的通貨膨脹風險？",
                "options": ["A. 債券", "B. 股票", "C. 黃金", "D. 定存"],
                "correct": 2,
                "explanation": "黃金被視為對抗通膨的避險資產，能夠在通貨膨脹時保持價值。"
            },
            {
                "question": "4. 為何在退休規劃中應該考慮加密貨幣投資？",
                "options": ["A. 高收益潛力", "B. 穩定回報", "C. 可隨時提領", "D. 高風險但增值潛力大"],
                "correct": 3,
                "explanation": "加密貨幣具有高風險和高回報，適合具有較高風險承受能力的投資者。"
            },
            {
                "question": "5. 若投資者的風險承受度較低，應該如何選擇投資工具？",
                "options": ["A. 高風險的股票", "B. 穩定回報的債券", "C. 高報酬的創業投資", "D. 加密貨幣"],
                "correct": 1,
                "explanation": "債券通常提供穩定回報，較適合風險承受度較低的投資者。"
            },
            {
                "question": "6. 在選擇投資基金時，應該考慮哪些因素？",
                "options": ["A. 基金過往的績效", "B. 基金的費用結構", "C. 基金經理的經驗", "D. 以上皆是"],
                "correct": 3,
                "explanation": "選擇基金時，應綜合考慮基金的過往績效、費用結構和基金經理的管理經驗等多方面因素。"
            },
            {
                "question": "7. 股票市場中的市盈率（P/E Ratio）用於衡量什麼？",
                "options": ["A. 公司利潤與股價之比", "B. 公司營收與利潤之比", "C. 公司負債與股東資本之比", "D. 以上皆非"],
                "correct": 0,
                "explanation": "市盈率（P/E Ratio）是用來衡量公司股價與其每股盈餘的比例，反映市場對公司未來成長的預期。"
            },
            {
                "question": "8. 若想在長期內獲得穩定的回報，應選擇何種資產配置？",
                "options": ["A. 完全投入股票市場", "B. 完全投入債券市場", "C. 股票與債券的適當混合", "D. 只選擇高報酬的資產"],
                "correct": 2,
                "explanation": "穩定回報的資產配置應該考慮股票與債券的適當搭配，以達到風險與回報的平衡。"
            },
            {
                "question": "9. 保險對投資理財的主要作用是什麼？",
                "options": ["A. 保障資本增值", "B. 提供保險金與保障", "C. 增加投資回報", "D. 減少市場風險"],
                "correct": 1,
                "explanation": "保險的主要功能是提供風險保障，防範突發的財務風險。"
            },
            {
                "question": "10. 投資者在退休規劃中應該如何避免過早賣出資產？",
                "options": ["A. 定期檢視資產配置", "B. 設定投資目標和時間表", "C. 保持長期投資心態", "D. 以上皆是"],
                "correct": 3,
                "explanation": "為了避免過早賣出資產，投資者應該設立明確的目標、時間表並保持長期投資心態。"
            }
        ];

        let currentQuestion = 0;
        let correctAnswers = 0;
        const feedback = [];

        function loadQuestion() {
            const questionData = questions[currentQuestion];
            if (!questionData) {
                const accuracy = calculateAccuracy();
                document.getElementById('question-container').innerHTML = `
                    測驗完成！正確率：${accuracy}%<br>
                    <button onclick="submitFeedback()">提交回饋</button>
                `;
                return;
            }

            const container = document.getElementById('question-container');
            container.innerHTML = `
                <p>${questionData.question}</p>
                ${questionData.options.map((option, index) => `
                    <button onclick="checkAnswer(${index})">${option}</button>
                `).join('')}
                <div id="feedback-container" style="display: none;">
                    <p>解析：${questionData.explanation}</p>
                    <label>此解析的有用程度（1-3分）：</label>
                    <select id="feedback-score">
                        <option value="1">1 - 不太有用</option>
                        <option value="2">2 - 普通</option>
                        <option value="3">3 - 很有用</option>
                    </select>
                    <button onclick="submitSingleFeedback()">下一題</button>
                </div>
            `;
        }

        function checkAnswer(selected) {
            const questionData = questions[currentQuestion];
            if (selected === questionData.correct) {
                correctAnswers++;
                alert("正確！");
                currentQuestion++;
                loadQuestion();
            } else {
                alert(`錯誤！正確答案是：${questionData.options[questionData.correct]}`);
                document.getElementById('feedback-container').style.display = 'block';
            }
        }

        function submitSingleFeedback() {
            const feedbackScore = document.getElementById('feedback-score').value;
            feedback.push({
                question: questions[currentQuestion].question,
                score: parseInt(feedbackScore)
            });
            document.getElementById('feedback-container').style.display = 'none';
            currentQuestion++;
            loadQuestion();
        }

        function calculateAccuracy() {
            const accuracy = ((correctAnswers / questions.length) * 100).toFixed(2);
            return accuracy > 100 ? 100 : accuracy; // 保證正確率不會超過100%
        }

        function submitFeedback() {
            const levelRef = db.ref('quizStats/level2');
            levelRef.once('value').then((snapshot) => {
                const stats = snapshot.val() || { participants: 0, correctCount: 0, scoreCount1: 0, scoreCount2: 0, scoreCount3: 0 };

                // 更新参与人数和正确回答数
                stats.participants += 1;
                stats.correctCount += correctAnswers;

                // 统计反馈分数
                const scoreCount1 = feedback.filter(item => item.score === 1).length;
                const scoreCount2 = feedback.filter(item => item.score === 2).length;
                const scoreCount3 = feedback.filter(item => item.score === 3).length;

                // 更新各反馈分数统计
                stats.scoreCount1 += scoreCount1;
                stats.scoreCount2 += scoreCount2;
                stats.scoreCount3 += scoreCount3;

                // 更新数据库
                return levelRef.set(stats);
            }).then(() => {
                // 更新完成后跳转
                alert("感謝您的參與！測驗結果已提交。");
                window.location.href = "index.html"; // 跳转到首页
            }).catch((error) => {
                // 处理错误
                console.error("提交失败：", error);
                alert("提交失败，请稍后重试。");
            });
        }

        loadQuestion();
    </script>
</body>
</html>
