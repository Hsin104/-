<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投資理財測驗 - 小白級</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // Firebase 初始化
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "https://pccujrjz-f0c56-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>
</head>
<body>
    <h1>投資理財測驗 - 小白級</h1>
    <div id="question-container"></div>

    <script>
        const questions = [
            {
                "question": "1. 若考慮購買基金投資，以下哪一個原因最適合做為選擇基金的考量因素？",
                "options": ["A. 過去的基金績效記錄", "B. 基金管理費的高低", "C. 對該基金的風險承受能力", "D. 朋友推薦"],
                "correct": 2,
                "explanation": "選擇基金時，了解自己對風險的承受能力是最重要的考量因素。"
            },
            {
                "question": "2. 若將資金分散投資於不同的資產，這樣的策略稱為什麼？",
                "options": ["A. 投資組合", "B. 分散投資", "C. 主動投資", "D. 股票操盤"],
                "correct": 1,
                "explanation": "分散投資是降低投資風險的一種策略。"
            },
            // 其餘問題略...
        ];

        let currentQuestion = 0;
        let score = 0;
        let feedback = [];

        function loadQuestion() {
            const questionData = questions[currentQuestion];
            if (!questionData) {
                document.getElementById('question-container').innerHTML = `
                    測驗完成！正確率：${Math.round((score / questions.length) * 100)}%
                    <button onclick="submitFeedback()">提交回饋</button>
                `;
                return;
            }

            const container = document.getElementById('question-container');
            container.innerHTML = `
                <p>${questionData.question}</p>
                ${questionData.options.map((option, index) => `
                    <button onclick="checkAnswer(${index})">${option}</button>
                `).join('')}
                <div id="feedback-container" style="display: none;">
                    <p>解析：${questionData.explanation}</p>
                    <label>此解析的有用程度（1-3分）：</label>
                    <select id="feedback-score">
                        <option value="1">1 - 不太有用</option>
                        <option value="2">2 - 普通</option>
                        <option value="3">3 - 很有用</option>
                    </select>
                    <button onclick="submitSingleFeedback()">下一題</button>
                </div>
            `;
        }

        function checkAnswer(selected) {
            const questionData = questions[currentQuestion];
            if (selected === questionData.correct) {
                score++;
                alert("正確！");
                currentQuestion++;
                loadQuestion();
            } else {
                alert(`錯誤！正確答案是：${questionData.options[questionData.correct]}`);
                document.getElementById('feedback-container').style.display = 'block';
            }
        }

        function submitSingleFeedback() {
            const feedbackScore = document.getElementById('feedback-score').value;
            feedback.push({
                question: questions[currentQuestion].question,
                score: parseInt(feedbackScore)
            });
            document.getElementById('feedback-container').style.display = 'none';
            currentQuestion++;
            loadQuestion();
        }

        function submitFeedback() {
            const levelRef = db.ref('quizStats/level1'); // 使用 level1 作為存儲節點
            levelRef.once('value').then((snapshot) => {
                const stats = snapshot.val() || { participants: 0, correctCount: 0, scoreCount1: 0, scoreCount2: 0, scoreCount3: 0 };

                // 更新參與人數和正確回答數
                stats.participants += 1;
                stats.correctCount += score;

                // 計算當前使用者的各分數統計數量
                const scoreCount1 = feedback.filter(item => item.score === 1).length;
                const scoreCount2 = feedback.filter(item => item.score === 2).length;
                const scoreCount3 = feedback.filter(item => item.score === 3).length;

                // 更新各分數統計
                stats.scoreCount1 += scoreCount1;
                stats.scoreCount2 += scoreCount2;
                stats.scoreCount3 += scoreCount3;

                // 更新數據到 Firebase
                return levelRef.set(stats);
            }).then(() => {
                alert("感謝您的參與！測驗結果已提交。");
                window.location.href = "index.html"; // 跳轉到主頁
            });
        }

        loadQuestion();
    </script>
</body>
</html>
